---
import BgGrid from "../assets/BgGrid.astro";
import SectionTitle from "../assets/SectionTitle.astro";
import { getCollection } from "astro:content";

const posts = await getCollection('projects', ({ data }) => {
const categories = Array.isArray(data.category)
? data.category.map(c => c.toLowerCase())
: [data.category.toLowerCase()];
return categories.includes('research');
});
const limitedEntries = posts.slice(0, 3);
---

<section class="border-black/20 border-b divide-y divide-black/20">
  <SectionTitle>
    Research & Insight
  </SectionTitle>
  <div class="p-8">
    <p class="text-black/80 font-black uppercase lg:text-xl">
      Deep dives into algorithms, statistics, and ML theory; <em>implemented from first principles.</em>
    </p>
  </div>

  <!-- Research cards in horizontal row -->
  <div class="grid grid-cols-1 md:grid-cols-3">
    {limitedEntries.map((post) => {
    const categories = Array.isArray(post.data.category) ? post.data.category : [post.data.category];
    const displayCategory = categories.find(c => !['project', 'projects', 'research'].includes(c.toLowerCase())) ||
    categories[0];
    return (
    <a href={`/projects/${post.id}/`}
      class="p-8 border-b border-black/10 md:border-b md:[&:not(:nth-child(3n))]:border-r hover:bg-orange/5 transition-colors block">
      <!-- Category label -->
      <p class="text-cyan text-sm font-mono mb-3 underline underline-offset-4 uppercase">
        {displayCategory}
      </p>

      <!-- Title -->
      <h4 class="font-black text-black uppercase text-sm lg:text-base mb-4 leading-tight">
        {post.data.title}
      </h4>

      <!-- Description -->
      <p class="text-black/70 text-sm leading-relaxed">
        {post.data.description}
      </p>
    </a>
    )})}
  </div>
</section>